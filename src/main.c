#include "headers.h"
#include "title_screen.h"
#include "save_room.h"
#include "player.h"
#include "../res/test_tiles.c"

void clear(void) {
    
    for (int i = 0; i < 18; i++) {
        for (int j = 0; j < 20; j++) {
            set_bkg_tile_xy(j,i,0);
        }

    }


}

void main(void) {    
    SHOW_SPRITES;
    SHOW_BKG;
    DISPLAY_ON;    
    set_bkg_data(0,4,TestTiles);
    clear();
    int map[22][22] = { 
        { 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1 , 1, 1 , 1 } ,
        { 1 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 1 , 1 } ,
        { 1 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 1 , 1 } ,  
        { 1 , 3 , 3 , 3 , 3 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 1 , 1 } ,
        { 1 , 3 , 3 , 3 , 3 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 1 , 1 } ,
        { 1 , 3 , 1 , 1 , 3 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 1 , 2 } ,
        { 1 , 3 , 1 , 1 , 3 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 2 , 3 } ,
        { 1 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 1 , 2 } , 
        { 1 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 1 , 1 } , 
        { 1 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 1 , 1 } , 
        { 1 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 1 , 1 } , 
        { 1 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 1 , 1 } , 
        { 1 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 1 , 2 } , 
        { 1 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 2 , 2 } , 
        { 1 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 3 , 3 } , 
        { 1 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 3 , 3 } , 
        { 1 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 1 , 1 } , 
        { 1 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 1 , 1 } , 
        { 1 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 3 , 3 } , 
        { 1 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 3 , 3 } , 
        { 1 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 3 , 3 } , 
        { 1 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 2 , 1, 3 , 3 } 
    };

    int camera_x;
    int camera_y;
    int moving = 0;
    camera_x = 0;
    camera_y = 0;
    vsync();
    while (1) {
        vsync();
        
        // Vertical loop.
        for (int i = camera_y; i < 18 + camera_y; i++) {
            // Horizontal loop.
            for (int j = camera_x; j < 20 + camera_x; j++) {
                // Set fixed x and y with camera relative x and y;
                set_bkg_tile_xy(j - camera_x,i - camera_y,map[i][j]);
            }
        }

        if (moving == 0) {
            if (joypad() & J_LEFT) {
                moving = 1;
                camera_x -=1;
                moving = 0;
            }           

           if (joypad() & J_RIGHT) {
                moving = 1;
                camera_x +=1;
                moving = 0;

            }          

            if (joypad() & J_UP) {
                moving = 1;
                camera_y -=1;
                moving = 0;
            }

            if (joypad() & J_DOWN) {
                moving = 1;
                camera_y += 1;
                moving = 0;

            }
        }

    }
    //saveRoom();
}
